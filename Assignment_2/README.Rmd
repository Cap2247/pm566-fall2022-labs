---
title: "Assignment_02"
author: "Camille Parchment"
date: "`r Sys.Date()`"
output: github_document
always_allow_html: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
if (!file.exists("individual.csv"))
download.file("https://raw.githubusercontent.com/USCbiostats/data-science-data/master/01_chs/chs_individual.csv", "individual.csv", method="libcurl", timeout = 60)
```
```{r}
indv <- read.csv("individual.csv")
```

```{r}
if (!file.exists("regional.csv"))
download.file("https://raw.githubusercontent.com/USCbiostats/data-science-data/master/01_chs/chs_regional.csv", "regional.csv", method="libcurl", timeout = 60)
```
```{r}
reg <- read.csv("regional.csv")
```

### Merge data 

```{r}
chs <- merge(indv, reg, by="townname")
```
```{r}
nrow(chs)
```

After merging based on  location (townname) there are still 1200 observations in our data set.

```{r}
library(tidytext)
library(tidyverse)
library(data.table)
library(dplyr)
library(ggplot2)
```
```{r}
chs <- as_tibble(chs)
```
```{r}
library(dtplyr)
```
### Impute data using the average within the variables “male” and “hispanic.”

```{r}
chs[, bmi_imp = fcoalesce(bmi, mean(bmi, na.rm = TRUE)),
by = .(male,hispanic)]

```

### Create a BMI catergorical variable and a summary table with underweight, normal weight, overweight, and obese. 

```{r}
obesity_level <- cut(chs$bmi, breaks=c(0, 14, 22, 24, 100), labels= c("underweight","normal", "overwight","obese"), right = FALSE)
```
```{r}
obesity_level[1:10]
```
```{r}
chs$bmi[1:10]
```
```{r}
summary(obesity_level) 
```
```{r}
summary(chs$bmi, na.rm = TRUE)
```



```{r}
smoke_gas_exposure <- ifelse(chs$smoke == 0 & chs$gasstove == 0 , "none",
                                            ifelse(chs$smoke == 1 & chs$gasstove == 0, "smoke_only",
                                            ifelse(chs$smoke == 0 & chs$gasstove == 1, "gas_only",
                                            ifelse(chs$smoke == 1 & chs$gasstove == 1, "both", NA))))
                                            table(smoke_gas_exposure, useNA = "always")
```
```{r}
library(data.table)
```
```{r}
chs <- data.table(chs)
```
### 4 tables gouped by town, sex, obesity_level, and smoke gas exposure
```{r}
town_averages <- chs[, .(
    fev_avg      = mean(fev, na.rm=TRUE),
    asthma_avg   = mean(asthma, na.rm=TRUE)),
    by = townname
    ][order(townname)] %>% head(n=10)
```
```{r}
sex_averages <- chs[, .(
    fev_avg      = mean(fev, na.rm=TRUE),
    asthma_avg   = mean(asthma, na.rm=TRUE)),
    by = male
    ][order(male)] %>% head(n=10)
```

```{r}
Obs_averages <- chs[, .(
    fev_avg      = mean(fev, na.rm=TRUE),
    asthma_avg   = mean(asthma, na.rm=TRUE)),
    by = obesity_level
    ][order(obesity_level)] 
```

```{r}
head(town_averages)
```
```{r}
head(sex_averages)
```
```{r}
head(Obs_averages)
```
### Part 2
### facet plot of BMI and FEV by townname 
```{r}
ggplot(chs, aes(x= bmi, y= fev, color= townname)) + geom_point() + facet_wrap(~ townname, ncol = 4)
```
```{r}
ggplot(chs, aes(x= obesity_level, fill= smoke_gas_exposure )) +geom_bar()
```
 
```{r}
ggplot(chs, aes(x= obesity_level, y= fev))+ geom_boxplot()
```
```{r}
ggplot(chs, aes(x=smoke_gas_exposure, y= fev )) + geom_boxplot()
```
 
```{r}
library(leaflet)
```

```{r}
pm2.pal <- colorNumeric(c('darkgreen','goldenrod','brown'), domain=chs$pm25_mass)

```


```{r}
pm25_avg <- chs[, .(
    pm25_mass    = mean(pm25_mass, na.rm=TRUE)),
    by = townname
    ][order(townname)] 
```

```{r}
ggplot(chs, aes(x= pm25_mass, y= fev )) +geom_boxplot()

```









